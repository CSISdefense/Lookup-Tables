--List new [detached_award_proc_unique] for insertion into Contract.contract_transaction_unique_key
SELECT fk.[detached_award_proc_unique],
'Contract.contract_transaction_unique_key' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Contract.contract_transaction_unique_key as pk
On pk.contract_transaction_unique_key=fk.[detached_award_proc_unique]
WHERE pk.contract_transaction_unique_key is NULL
GROUP BY fk.[detached_award_proc_unique]
ORDER BY fk.[detached_award_proc_unique]


--List new [action_type] and updated action_type_description for insertion into FPDSTypeTable.reasonformodification
SELECT fk.[action_type],
max(iif(fk.action_type_description=pk.reasonformodificationText or
	fk.action_type_description='' or
	charindex('('+fk.action_type_description+')',pk.reasonformodificationText )>0,
	NULL,fk.action_type_description)) as MaxOfNewFKaction_type_description,
count(distinct iif(fk.action_type_description=pk.reasonformodificationText or
	fk.action_type_description='' or
	charindex('('+fk.action_type_description+')',pk.reasonformodificationText )>0,
	NULL,fk.action_type_description)) as unmatched_name_count,
pk.reasonformodificationText as PKreasonformodificationText,
max(iif(fk.action_type_description=pk.reasonformodificationText or
	fk.action_type_description='' or
	charindex('('+fk.action_type_description+')',pk.reasonformodificationText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.reasonformodification' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.reasonformodification as pk
On pk.reasonformodification=fk.[action_type]
GROUP BY fk.[action_type], pk.reasonformodificationText
HAVING max(iif(fk.action_type_description=pk.reasonformodificationText or
	fk.action_type_description='' or
	charindex('('+fk.action_type_description+')',pk.reasonformodificationText )>0,
	0,1))=1
ORDER BY fk.[action_type]


--List new [agency_id] for insertion into FPDSTypeTable.AgencyID
SELECT fk.[agency_id],
'FPDSTypeTable.AgencyID' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.AgencyID as pk
On pk.AgencyID=fk.[agency_id]
WHERE pk.AgencyID is NULL
GROUP BY fk.[agency_id]
ORDER BY fk.[agency_id]


--List new [award_or_idv_flag] for insertion into Contract.award_or_idv_flag
SELECT fk.[award_or_idv_flag],
'Contract.award_or_idv_flag' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Contract.award_or_idv_flag as pk
On pk.award_or_idv_flag=fk.[award_or_idv_flag]
WHERE pk.award_or_idv_flag is NULL
GROUP BY fk.[award_or_idv_flag]
ORDER BY fk.[award_or_idv_flag]


--List new [awardee_or_recipient_uniqu] for insertion into Contractor.Dunsnumber
SELECT fk.[awardee_or_recipient_uniqu],
'Contractor.Dunsnumber' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Contractor.Dunsnumber as pk
On pk.DUNSnumber=fk.[awardee_or_recipient_uniqu]
WHERE pk.DUNSnumber is NULL
GROUP BY fk.[awardee_or_recipient_uniqu]
ORDER BY fk.[awardee_or_recipient_uniqu]


--List new [awarding_agency_code] and updated awarding_agency_name for insertion into agency.awarding_agency_code
SELECT fk.[awarding_agency_code],
max(iif(fk.awarding_agency_name=pk.awarding_agency_name or
	fk.awarding_agency_name='' or
	charindex('('+fk.awarding_agency_name+')',pk.awarding_agency_name )>0,
	NULL,fk.awarding_agency_name)) as MaxOfNewFKawarding_agency_name,
count(distinct iif(fk.awarding_agency_name=pk.awarding_agency_name or
	fk.awarding_agency_name='' or
	charindex('('+fk.awarding_agency_name+')',pk.awarding_agency_name )>0,
	NULL,fk.awarding_agency_name)) as unmatched_name_count,
pk.awarding_agency_name as PKawarding_agency_name,
max(iif(fk.awarding_agency_name=pk.awarding_agency_name or
	fk.awarding_agency_name='' or
	charindex('('+fk.awarding_agency_name+')',pk.awarding_agency_name )>0,
	1,0)) as any_name_match,
'agency.awarding_agency_code' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN agency.awarding_agency_code as pk
On pk.awarding_agency_code=fk.[awarding_agency_code]
GROUP BY fk.[awarding_agency_code], pk.awarding_agency_name
HAVING max(iif(fk.awarding_agency_name=pk.awarding_agency_name or
	fk.awarding_agency_name='' or
	charindex('('+fk.awarding_agency_name+')',pk.awarding_agency_name )>0,
	0,1))=1
ORDER BY fk.[awarding_agency_code]


--List new [awarding_sub_tier_agency_c] and updated awarding_sub_tier_agency_n for insertion into FPDSTypeTable.AgencyID
SELECT fk.[awarding_sub_tier_agency_c],
max(iif(fk.awarding_sub_tier_agency_n=pk.AgencyIDtext or
	fk.awarding_sub_tier_agency_n='' or
	charindex('('+fk.awarding_sub_tier_agency_n+')',pk.AgencyIDtext )>0,
	NULL,fk.awarding_sub_tier_agency_n)) as MaxOfNewFKawarding_sub_tier_agency_n,
count(distinct iif(fk.awarding_sub_tier_agency_n=pk.AgencyIDtext or
	fk.awarding_sub_tier_agency_n='' or
	charindex('('+fk.awarding_sub_tier_agency_n+')',pk.AgencyIDtext )>0,
	NULL,fk.awarding_sub_tier_agency_n)) as unmatched_name_count,
pk.AgencyIDtext as PKAgencyIDtext,
max(iif(fk.awarding_sub_tier_agency_n=pk.AgencyIDtext or
	fk.awarding_sub_tier_agency_n='' or
	charindex('('+fk.awarding_sub_tier_agency_n+')',pk.AgencyIDtext )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.AgencyID' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.AgencyID as pk
On pk.AgencyID=fk.[awarding_sub_tier_agency_c]
GROUP BY fk.[awarding_sub_tier_agency_c], pk.AgencyIDtext
HAVING max(iif(fk.awarding_sub_tier_agency_n=pk.AgencyIDtext or
	fk.awarding_sub_tier_agency_n='' or
	charindex('('+fk.awarding_sub_tier_agency_n+')',pk.AgencyIDtext )>0,
	0,1))=1
ORDER BY fk.[awarding_sub_tier_agency_c]


--List new [commercial_item_acquisitio] and updated commercial_item_acqui_desc for insertion into FPDSTypeTable.CommercialItemAcquisitionProcedures
SELECT fk.[commercial_item_acquisitio],
max(iif(fk.commercial_item_acqui_desc=pk.CommercialItemAcquisitionProceduresText or
	fk.commercial_item_acqui_desc='' or
	charindex('('+fk.commercial_item_acqui_desc+')',pk.CommercialItemAcquisitionProceduresText )>0,
	NULL,fk.commercial_item_acqui_desc)) as MaxOfNewFKcommercial_item_acqui_desc,
count(distinct iif(fk.commercial_item_acqui_desc=pk.CommercialItemAcquisitionProceduresText or
	fk.commercial_item_acqui_desc='' or
	charindex('('+fk.commercial_item_acqui_desc+')',pk.CommercialItemAcquisitionProceduresText )>0,
	NULL,fk.commercial_item_acqui_desc)) as unmatched_name_count,
pk.CommercialItemAcquisitionProceduresText as PKCommercialItemAcquisitionProceduresText,
max(iif(fk.commercial_item_acqui_desc=pk.CommercialItemAcquisitionProceduresText or
	fk.commercial_item_acqui_desc='' or
	charindex('('+fk.commercial_item_acqui_desc+')',pk.CommercialItemAcquisitionProceduresText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.CommercialItemAcquisitionProcedures' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.CommercialItemAcquisitionProcedures as pk
On pk.CommercialItemAcquisitionProcedures=fk.[commercial_item_acquisitio]
GROUP BY fk.[commercial_item_acquisitio], pk.CommercialItemAcquisitionProceduresText
HAVING max(iif(fk.commercial_item_acqui_desc=pk.CommercialItemAcquisitionProceduresText or
	fk.commercial_item_acqui_desc='' or
	charindex('('+fk.commercial_item_acqui_desc+')',pk.CommercialItemAcquisitionProceduresText )>0,
	0,1))=1
ORDER BY fk.[commercial_item_acquisitio]


--List new [commercial_item_test_progr] and updated commercial_item_test_desc for insertion into FPDSTypeTable.simplified_procedures_for_certain_commercial_items_code
SELECT fk.[commercial_item_test_progr],
max(iif(fk.commercial_item_test_desc=pk.simplified_procedures_for_certain_commercial_items or
	fk.commercial_item_test_desc='' or
	charindex('('+fk.commercial_item_test_desc+')',pk.simplified_procedures_for_certain_commercial_items )>0,
	NULL,fk.commercial_item_test_desc)) as MaxOfNewFKcommercial_item_test_desc,
count(distinct iif(fk.commercial_item_test_desc=pk.simplified_procedures_for_certain_commercial_items or
	fk.commercial_item_test_desc='' or
	charindex('('+fk.commercial_item_test_desc+')',pk.simplified_procedures_for_certain_commercial_items )>0,
	NULL,fk.commercial_item_test_desc)) as unmatched_name_count,
pk.simplified_procedures_for_certain_commercial_items as PKsimplified_procedures_for_certain_commercial_items,
max(iif(fk.commercial_item_test_desc=pk.simplified_procedures_for_certain_commercial_items or
	fk.commercial_item_test_desc='' or
	charindex('('+fk.commercial_item_test_desc+')',pk.simplified_procedures_for_certain_commercial_items )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.simplified_procedures_for_certain_commercial_items_code' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.simplified_procedures_for_certain_commercial_items_code as pk
On pk.simplified_procedures_for_certain_commercial_items_code=fk.[commercial_item_test_progr]
GROUP BY fk.[commercial_item_test_progr], pk.simplified_procedures_for_certain_commercial_items
HAVING max(iif(fk.commercial_item_test_desc=pk.simplified_procedures_for_certain_commercial_items or
	fk.commercial_item_test_desc='' or
	charindex('('+fk.commercial_item_test_desc+')',pk.simplified_procedures_for_certain_commercial_items )>0,
	0,1))=1
ORDER BY fk.[commercial_item_test_progr]


--List new [consolidated_contract] and updated consolidated_contract_desc for insertion into Contract.consolidatedcontract
SELECT fk.[consolidated_contract],
max(iif(fk.consolidated_contract_desc=pk.consolidated_contract_name or
	fk.consolidated_contract_desc='' or
	charindex('('+fk.consolidated_contract_desc+')',pk.consolidated_contract_name )>0,
	NULL,fk.consolidated_contract_desc)) as MaxOfNewFKconsolidated_contract_desc,
count(distinct iif(fk.consolidated_contract_desc=pk.consolidated_contract_name or
	fk.consolidated_contract_desc='' or
	charindex('('+fk.consolidated_contract_desc+')',pk.consolidated_contract_name )>0,
	NULL,fk.consolidated_contract_desc)) as unmatched_name_count,
pk.consolidated_contract_name as PKconsolidated_contract_name,
max(iif(fk.consolidated_contract_desc=pk.consolidated_contract_name or
	fk.consolidated_contract_desc='' or
	charindex('('+fk.consolidated_contract_desc+')',pk.consolidated_contract_name )>0,
	1,0)) as any_name_match,
'Contract.consolidatedcontract' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Contract.consolidatedcontract as pk
On pk.consolidatedcontract=fk.[consolidated_contract]
GROUP BY fk.[consolidated_contract], pk.consolidated_contract_name
HAVING max(iif(fk.consolidated_contract_desc=pk.consolidated_contract_name or
	fk.consolidated_contract_desc='' or
	charindex('('+fk.consolidated_contract_desc+')',pk.consolidated_contract_name )>0,
	0,1))=1
ORDER BY fk.[consolidated_contract]


--List new [construction_wage_rate_req] and updated construction_wage_rat_desc for insertion into FPDSTypeTable.davisbaconact
SELECT fk.[construction_wage_rate_req],
max(iif(fk.construction_wage_rat_desc=pk.davisbaconactText or
	fk.construction_wage_rat_desc='' or
	charindex('('+fk.construction_wage_rat_desc+')',pk.davisbaconactText )>0,
	NULL,fk.construction_wage_rat_desc)) as MaxOfNewFKconstruction_wage_rat_desc,
count(distinct iif(fk.construction_wage_rat_desc=pk.davisbaconactText or
	fk.construction_wage_rat_desc='' or
	charindex('('+fk.construction_wage_rat_desc+')',pk.davisbaconactText )>0,
	NULL,fk.construction_wage_rat_desc)) as unmatched_name_count,
pk.davisbaconactText as PKdavisbaconactText,
max(iif(fk.construction_wage_rat_desc=pk.davisbaconactText or
	fk.construction_wage_rat_desc='' or
	charindex('('+fk.construction_wage_rat_desc+')',pk.davisbaconactText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.davisbaconact' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.davisbaconact as pk
On pk.davisbaconact=fk.[construction_wage_rate_req]
GROUP BY fk.[construction_wage_rate_req], pk.davisbaconactText
HAVING max(iif(fk.construction_wage_rat_desc=pk.davisbaconactText or
	fk.construction_wage_rat_desc='' or
	charindex('('+fk.construction_wage_rat_desc+')',pk.davisbaconactText )>0,
	0,1))=1
ORDER BY fk.[construction_wage_rate_req]


--List new [contingency_humanitarian_o] and updated contingency_humanitar_desc for insertion into Assistance.ContingencyHumanitarianPeacekeepingOperation
SELECT fk.[contingency_humanitarian_o],
max(iif(fk.contingency_humanitar_desc=pk.contingencyhumanitarianpeacekeepingoperationText or
	fk.contingency_humanitar_desc='' or
	charindex('('+fk.contingency_humanitar_desc+')',pk.contingencyhumanitarianpeacekeepingoperationText )>0,
	NULL,fk.contingency_humanitar_desc)) as MaxOfNewFKcontingency_humanitar_desc,
count(distinct iif(fk.contingency_humanitar_desc=pk.contingencyhumanitarianpeacekeepingoperationText or
	fk.contingency_humanitar_desc='' or
	charindex('('+fk.contingency_humanitar_desc+')',pk.contingencyhumanitarianpeacekeepingoperationText )>0,
	NULL,fk.contingency_humanitar_desc)) as unmatched_name_count,
pk.contingencyhumanitarianpeacekeepingoperationText as PKcontingencyhumanitarianpeacekeepingoperationText,
max(iif(fk.contingency_humanitar_desc=pk.contingencyhumanitarianpeacekeepingoperationText or
	fk.contingency_humanitar_desc='' or
	charindex('('+fk.contingency_humanitar_desc+')',pk.contingencyhumanitarianpeacekeepingoperationText )>0,
	1,0)) as any_name_match,
'Assistance.ContingencyHumanitarianPeacekeepingOperation' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Assistance.ContingencyHumanitarianPeacekeepingOperation as pk
On pk.ContingencyHumanitarianPeacekeepingOperation=fk.[contingency_humanitarian_o]
GROUP BY fk.[contingency_humanitarian_o], pk.contingencyhumanitarianpeacekeepingoperationText
HAVING max(iif(fk.contingency_humanitar_desc=pk.contingencyhumanitarianpeacekeepingoperationText or
	fk.contingency_humanitar_desc='' or
	charindex('('+fk.contingency_humanitar_desc+')',pk.contingencyhumanitarianpeacekeepingoperationText )>0,
	0,1))=1
ORDER BY fk.[contingency_humanitarian_o]


--List new [contract_award_type] and updated contract_award_type_desc for insertion into FPDSTypeTable.award_type_code
SELECT fk.[contract_award_type],
max(iif(fk.contract_award_type_desc=pk.award_type_name or
	fk.contract_award_type_desc='' or
	charindex('('+fk.contract_award_type_desc+')',pk.award_type_name )>0,
	NULL,fk.contract_award_type_desc)) as MaxOfNewFKcontract_award_type_desc,
count(distinct iif(fk.contract_award_type_desc=pk.award_type_name or
	fk.contract_award_type_desc='' or
	charindex('('+fk.contract_award_type_desc+')',pk.award_type_name )>0,
	NULL,fk.contract_award_type_desc)) as unmatched_name_count,
pk.award_type_name as PKaward_type_name,
max(iif(fk.contract_award_type_desc=pk.award_type_name or
	fk.contract_award_type_desc='' or
	charindex('('+fk.contract_award_type_desc+')',pk.award_type_name )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.award_type_code' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.award_type_code as pk
On pk.award_type_code=fk.[contract_award_type]
GROUP BY fk.[contract_award_type], pk.award_type_name
HAVING max(iif(fk.contract_award_type_desc=pk.award_type_name or
	fk.contract_award_type_desc='' or
	charindex('('+fk.contract_award_type_desc+')',pk.award_type_name )>0,
	0,1))=1
ORDER BY fk.[contract_award_type]


--List new [contract_bundling] and updated contract_bundling_descrip for insertion into FPDSTypeTable.contractbundling
SELECT fk.[contract_bundling],
max(iif(fk.contract_bundling_descrip=pk.contractbundlingText or
	fk.contract_bundling_descrip='' or
	charindex('('+fk.contract_bundling_descrip+')',pk.contractbundlingText )>0,
	NULL,fk.contract_bundling_descrip)) as MaxOfNewFKcontract_bundling_descrip,
count(distinct iif(fk.contract_bundling_descrip=pk.contractbundlingText or
	fk.contract_bundling_descrip='' or
	charindex('('+fk.contract_bundling_descrip+')',pk.contractbundlingText )>0,
	NULL,fk.contract_bundling_descrip)) as unmatched_name_count,
pk.contractbundlingText as PKcontractbundlingText,
max(iif(fk.contract_bundling_descrip=pk.contractbundlingText or
	fk.contract_bundling_descrip='' or
	charindex('('+fk.contract_bundling_descrip+')',pk.contractbundlingText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.contractbundling' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.contractbundling as pk
On pk.contractbundling=fk.[contract_bundling]
GROUP BY fk.[contract_bundling], pk.contractbundlingText
HAVING max(iif(fk.contract_bundling_descrip=pk.contractbundlingText or
	fk.contract_bundling_descrip='' or
	charindex('('+fk.contract_bundling_descrip+')',pk.contractbundlingText )>0,
	0,1))=1
ORDER BY fk.[contract_bundling]


--List new [contract_financing] and updated contract_financing_descrip for insertion into FPDSTypeTable.contractfinancing
SELECT fk.[contract_financing],
max(iif(fk.contract_financing_descrip=pk.contractfinancingText or
	fk.contract_financing_descrip='' or
	charindex('('+fk.contract_financing_descrip+')',pk.contractfinancingText )>0,
	NULL,fk.contract_financing_descrip)) as MaxOfNewFKcontract_financing_descrip,
count(distinct iif(fk.contract_financing_descrip=pk.contractfinancingText or
	fk.contract_financing_descrip='' or
	charindex('('+fk.contract_financing_descrip+')',pk.contractfinancingText )>0,
	NULL,fk.contract_financing_descrip)) as unmatched_name_count,
pk.contractfinancingText as PKcontractfinancingText,
max(iif(fk.contract_financing_descrip=pk.contractfinancingText or
	fk.contract_financing_descrip='' or
	charindex('('+fk.contract_financing_descrip+')',pk.contractfinancingText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.contractfinancing' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.contractfinancing as pk
On pk.contractfinancing=fk.[contract_financing]
GROUP BY fk.[contract_financing], pk.contractfinancingText
HAVING max(iif(fk.contract_financing_descrip=pk.contractfinancingText or
	fk.contract_financing_descrip='' or
	charindex('('+fk.contract_financing_descrip+')',pk.contractfinancingText )>0,
	0,1))=1
ORDER BY fk.[contract_financing]


--List new [contracting_officers_deter] and updated contracting_officers_desc for insertion into FPDSTypeTable.contractingofficerbusinesssizedetermination
SELECT fk.[contracting_officers_deter],
max(iif(fk.contracting_officers_desc=pk.ContractingOfficerBusinessSizeDeterminationText or
	fk.contracting_officers_desc='' or
	charindex('('+fk.contracting_officers_desc+')',pk.ContractingOfficerBusinessSizeDeterminationText )>0,
	NULL,fk.contracting_officers_desc)) as MaxOfNewFKcontracting_officers_desc,
count(distinct iif(fk.contracting_officers_desc=pk.ContractingOfficerBusinessSizeDeterminationText or
	fk.contracting_officers_desc='' or
	charindex('('+fk.contracting_officers_desc+')',pk.ContractingOfficerBusinessSizeDeterminationText )>0,
	NULL,fk.contracting_officers_desc)) as unmatched_name_count,
pk.ContractingOfficerBusinessSizeDeterminationText as PKContractingOfficerBusinessSizeDeterminationText,
max(iif(fk.contracting_officers_desc=pk.ContractingOfficerBusinessSizeDeterminationText or
	fk.contracting_officers_desc='' or
	charindex('('+fk.contracting_officers_desc+')',pk.ContractingOfficerBusinessSizeDeterminationText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.contractingofficerbusinesssizedetermination' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.contractingofficerbusinesssizedetermination as pk
On pk.contractingofficerbusinesssizedetermination=fk.[contracting_officers_deter]
GROUP BY fk.[contracting_officers_deter], pk.ContractingOfficerBusinessSizeDeterminationText
HAVING max(iif(fk.contracting_officers_desc=pk.ContractingOfficerBusinessSizeDeterminationText or
	fk.contracting_officers_desc='' or
	charindex('('+fk.contracting_officers_desc+')',pk.ContractingOfficerBusinessSizeDeterminationText )>0,
	0,1))=1
ORDER BY fk.[contracting_officers_deter]


--List new [cost_accounting_standards] and updated cost_accounting_stand_desc for insertion into FPDSTypeTable.CostAccountingStandardsClause
SELECT fk.[cost_accounting_standards],
max(iif(fk.cost_accounting_stand_desc=pk.cost_accounting_standards_clause_name or
	fk.cost_accounting_stand_desc='' or
	charindex('('+fk.cost_accounting_stand_desc+')',pk.cost_accounting_standards_clause_name )>0,
	NULL,fk.cost_accounting_stand_desc)) as MaxOfNewFKcost_accounting_stand_desc,
count(distinct iif(fk.cost_accounting_stand_desc=pk.cost_accounting_standards_clause_name or
	fk.cost_accounting_stand_desc='' or
	charindex('('+fk.cost_accounting_stand_desc+')',pk.cost_accounting_standards_clause_name )>0,
	NULL,fk.cost_accounting_stand_desc)) as unmatched_name_count,
pk.cost_accounting_standards_clause_name as PKcost_accounting_standards_clause_name,
max(iif(fk.cost_accounting_stand_desc=pk.cost_accounting_standards_clause_name or
	fk.cost_accounting_stand_desc='' or
	charindex('('+fk.cost_accounting_stand_desc+')',pk.cost_accounting_standards_clause_name )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.CostAccountingStandardsClause' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.CostAccountingStandardsClause as pk
On pk.CostAccountingStandardsClause=fk.[cost_accounting_standards]
GROUP BY fk.[cost_accounting_standards], pk.cost_accounting_standards_clause_name
HAVING max(iif(fk.cost_accounting_stand_desc=pk.cost_accounting_standards_clause_name or
	fk.cost_accounting_stand_desc='' or
	charindex('('+fk.cost_accounting_stand_desc+')',pk.cost_accounting_standards_clause_name )>0,
	0,1))=1
ORDER BY fk.[cost_accounting_standards]


--List new [cost_or_pricing_data] and updated cost_or_pricing_data_desc for insertion into FPDSTypeTable.costorpricingdata
SELECT fk.[cost_or_pricing_data],
max(iif(fk.cost_or_pricing_data_desc=pk.costorpricingdataText or
	fk.cost_or_pricing_data_desc='' or
	charindex('('+fk.cost_or_pricing_data_desc+')',pk.costorpricingdataText )>0,
	NULL,fk.cost_or_pricing_data_desc)) as MaxOfNewFKcost_or_pricing_data_desc,
count(distinct iif(fk.cost_or_pricing_data_desc=pk.costorpricingdataText or
	fk.cost_or_pricing_data_desc='' or
	charindex('('+fk.cost_or_pricing_data_desc+')',pk.costorpricingdataText )>0,
	NULL,fk.cost_or_pricing_data_desc)) as unmatched_name_count,
pk.costorpricingdataText as PKcostorpricingdataText,
max(iif(fk.cost_or_pricing_data_desc=pk.costorpricingdataText or
	fk.cost_or_pricing_data_desc='' or
	charindex('('+fk.cost_or_pricing_data_desc+')',pk.costorpricingdataText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.costorpricingdata' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.costorpricingdata as pk
On pk.costorpricingdata=fk.[cost_or_pricing_data]
GROUP BY fk.[cost_or_pricing_data], pk.costorpricingdataText
HAVING max(iif(fk.cost_or_pricing_data_desc=pk.costorpricingdataText or
	fk.cost_or_pricing_data_desc='' or
	charindex('('+fk.cost_or_pricing_data_desc+')',pk.costorpricingdataText )>0,
	0,1))=1
ORDER BY fk.[cost_or_pricing_data]


--List new [country_of_product_or_serv] and updated country_of_product_or_desc for insertion into FPDSTypeTable.Country3LetterCode
SELECT fk.[country_of_product_or_serv],
max(iif(fk.country_of_product_or_desc=pk.Country3LetterCodeText or
	fk.country_of_product_or_desc='' or
	charindex('('+fk.country_of_product_or_desc+')',pk.Country3LetterCodeText )>0,
	NULL,fk.country_of_product_or_desc)) as MaxOfNewFKcountry_of_product_or_desc,
count(distinct iif(fk.country_of_product_or_desc=pk.Country3LetterCodeText or
	fk.country_of_product_or_desc='' or
	charindex('('+fk.country_of_product_or_desc+')',pk.Country3LetterCodeText )>0,
	NULL,fk.country_of_product_or_desc)) as unmatched_name_count,
pk.Country3LetterCodeText as PKCountry3LetterCodeText,
max(iif(fk.country_of_product_or_desc=pk.Country3LetterCodeText or
	fk.country_of_product_or_desc='' or
	charindex('('+fk.country_of_product_or_desc+')',pk.Country3LetterCodeText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.Country3LetterCode' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.Country3LetterCode as pk
On pk.Country3LetterCode=fk.[country_of_product_or_serv]
GROUP BY fk.[country_of_product_or_serv], pk.Country3LetterCodeText
HAVING max(iif(fk.country_of_product_or_desc=pk.Country3LetterCodeText or
	fk.country_of_product_or_desc='' or
	charindex('('+fk.country_of_product_or_desc+')',pk.Country3LetterCodeText )>0,
	0,1))=1
ORDER BY fk.[country_of_product_or_serv]


--List new [division_name] for insertion into Vendor.VendorName
SELECT fk.[division_name],
'Vendor.VendorName' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Vendor.VendorName as pk
On pk.vendorname=fk.[division_name]
WHERE pk.vendorname is NULL
GROUP BY fk.[division_name]
ORDER BY fk.[division_name]


--List new [dod_claimant_program_code] and updated dod_claimant_prog_cod_desc for insertion into FPDSTypeTable.ClaimantProgramCode
SELECT fk.[dod_claimant_program_code],
max(iif(fk.dod_claimant_prog_cod_desc=pk.ClaimantProgramCodeText or
	fk.dod_claimant_prog_cod_desc='' or
	charindex('('+fk.dod_claimant_prog_cod_desc+')',pk.ClaimantProgramCodeText )>0,
	NULL,fk.dod_claimant_prog_cod_desc)) as MaxOfNewFKdod_claimant_prog_cod_desc,
count(distinct iif(fk.dod_claimant_prog_cod_desc=pk.ClaimantProgramCodeText or
	fk.dod_claimant_prog_cod_desc='' or
	charindex('('+fk.dod_claimant_prog_cod_desc+')',pk.ClaimantProgramCodeText )>0,
	NULL,fk.dod_claimant_prog_cod_desc)) as unmatched_name_count,
pk.ClaimantProgramCodeText as PKClaimantProgramCodeText,
max(iif(fk.dod_claimant_prog_cod_desc=pk.ClaimantProgramCodeText or
	fk.dod_claimant_prog_cod_desc='' or
	charindex('('+fk.dod_claimant_prog_cod_desc+')',pk.ClaimantProgramCodeText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.ClaimantProgramCode' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.ClaimantProgramCode as pk
On pk.ClaimantProgramCode=fk.[dod_claimant_program_code]
GROUP BY fk.[dod_claimant_program_code], pk.ClaimantProgramCodeText
HAVING max(iif(fk.dod_claimant_prog_cod_desc=pk.ClaimantProgramCodeText or
	fk.dod_claimant_prog_cod_desc='' or
	charindex('('+fk.dod_claimant_prog_cod_desc+')',pk.ClaimantProgramCodeText )>0,
	0,1))=1
ORDER BY fk.[dod_claimant_program_code]


--List new [domestic_or_foreign_entity] and updated domestic_or_foreign_e_desc for insertion into FPDSTypeTable.manufacturingorganizationtype
SELECT fk.[domestic_or_foreign_entity],
max(iif(fk.domestic_or_foreign_e_desc=pk.manufacturingorganizationtypeText or
	fk.domestic_or_foreign_e_desc='' or
	charindex('('+fk.domestic_or_foreign_e_desc+')',pk.manufacturingorganizationtypeText )>0,
	NULL,fk.domestic_or_foreign_e_desc)) as MaxOfNewFKdomestic_or_foreign_e_desc,
count(distinct iif(fk.domestic_or_foreign_e_desc=pk.manufacturingorganizationtypeText or
	fk.domestic_or_foreign_e_desc='' or
	charindex('('+fk.domestic_or_foreign_e_desc+')',pk.manufacturingorganizationtypeText )>0,
	NULL,fk.domestic_or_foreign_e_desc)) as unmatched_name_count,
pk.manufacturingorganizationtypeText as PKmanufacturingorganizationtypeText,
max(iif(fk.domestic_or_foreign_e_desc=pk.manufacturingorganizationtypeText or
	fk.domestic_or_foreign_e_desc='' or
	charindex('('+fk.domestic_or_foreign_e_desc+')',pk.manufacturingorganizationtypeText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.manufacturingorganizationtype' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.manufacturingorganizationtype as pk
On pk.manufacturingorganizationtype=fk.[domestic_or_foreign_entity]
GROUP BY fk.[domestic_or_foreign_entity], pk.manufacturingorganizationtypeText
HAVING max(iif(fk.domestic_or_foreign_e_desc=pk.manufacturingorganizationtypeText or
	fk.domestic_or_foreign_e_desc='' or
	charindex('('+fk.domestic_or_foreign_e_desc+')',pk.manufacturingorganizationtypeText )>0,
	0,1))=1
ORDER BY fk.[domestic_or_foreign_entity]


--List new [epa_designated_product] and updated epa_designated_produc_desc for insertion into FPDSTypeTable.useofepadesignatedproducts
SELECT fk.[epa_designated_product],
max(iif(fk.epa_designated_produc_desc=pk.useofepadesignatedproductsText or
	fk.epa_designated_produc_desc='' or
	charindex('('+fk.epa_designated_produc_desc+')',pk.useofepadesignatedproductsText )>0,
	NULL,fk.epa_designated_produc_desc)) as MaxOfNewFKepa_designated_produc_desc,
count(distinct iif(fk.epa_designated_produc_desc=pk.useofepadesignatedproductsText or
	fk.epa_designated_produc_desc='' or
	charindex('('+fk.epa_designated_produc_desc+')',pk.useofepadesignatedproductsText )>0,
	NULL,fk.epa_designated_produc_desc)) as unmatched_name_count,
pk.useofepadesignatedproductsText as PKuseofepadesignatedproductsText,
max(iif(fk.epa_designated_produc_desc=pk.useofepadesignatedproductsText or
	fk.epa_designated_produc_desc='' or
	charindex('('+fk.epa_designated_produc_desc+')',pk.useofepadesignatedproductsText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.useofepadesignatedproducts' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.useofepadesignatedproducts as pk
On pk.useofepadesignatedproducts=fk.[epa_designated_product]
GROUP BY fk.[epa_designated_product], pk.useofepadesignatedproductsText
HAVING max(iif(fk.epa_designated_produc_desc=pk.useofepadesignatedproductsText or
	fk.epa_designated_produc_desc='' or
	charindex('('+fk.epa_designated_produc_desc+')',pk.useofepadesignatedproductsText )>0,
	0,1))=1
ORDER BY fk.[epa_designated_product]


--List new [evaluated_preference] and updated evaluated_preference_desc for insertion into FPDSTypeTable.evaluatedpreference
SELECT fk.[evaluated_preference],
max(iif(fk.evaluated_preference_desc=pk.evaluatedpreferenceText or
	fk.evaluated_preference_desc='' or
	charindex('('+fk.evaluated_preference_desc+')',pk.evaluatedpreferenceText )>0,
	NULL,fk.evaluated_preference_desc)) as MaxOfNewFKevaluated_preference_desc,
count(distinct iif(fk.evaluated_preference_desc=pk.evaluatedpreferenceText or
	fk.evaluated_preference_desc='' or
	charindex('('+fk.evaluated_preference_desc+')',pk.evaluatedpreferenceText )>0,
	NULL,fk.evaluated_preference_desc)) as unmatched_name_count,
pk.evaluatedpreferenceText as PKevaluatedpreferenceText,
max(iif(fk.evaluated_preference_desc=pk.evaluatedpreferenceText or
	fk.evaluated_preference_desc='' or
	charindex('('+fk.evaluated_preference_desc+')',pk.evaluatedpreferenceText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.evaluatedpreference' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.evaluatedpreference as pk
On pk.evaluatedpreference=fk.[evaluated_preference]
GROUP BY fk.[evaluated_preference], pk.evaluatedpreferenceText
HAVING max(iif(fk.evaluated_preference_desc=pk.evaluatedpreferenceText or
	fk.evaluated_preference_desc='' or
	charindex('('+fk.evaluated_preference_desc+')',pk.evaluatedpreferenceText )>0,
	0,1))=1
ORDER BY fk.[evaluated_preference]


--List new [extent_competed] and updated extent_compete_description for insertion into FPDSTypeTable.extentcompeted
SELECT fk.[extent_competed],
max(iif(fk.extent_compete_description=pk.extentcompetedText or
	fk.extent_compete_description='' or
	charindex('('+fk.extent_compete_description+')',pk.extentcompetedText )>0,
	NULL,fk.extent_compete_description)) as MaxOfNewFKextent_compete_description,
count(distinct iif(fk.extent_compete_description=pk.extentcompetedText or
	fk.extent_compete_description='' or
	charindex('('+fk.extent_compete_description+')',pk.extentcompetedText )>0,
	NULL,fk.extent_compete_description)) as unmatched_name_count,
pk.extentcompetedText as PKextentcompetedText,
max(iif(fk.extent_compete_description=pk.extentcompetedText or
	fk.extent_compete_description='' or
	charindex('('+fk.extent_compete_description+')',pk.extentcompetedText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.extentcompeted' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.extentcompeted as pk
On pk.extentcompeted=fk.[extent_competed]
GROUP BY fk.[extent_competed], pk.extentcompetedText
HAVING max(iif(fk.extent_compete_description=pk.extentcompetedText or
	fk.extent_compete_description='' or
	charindex('('+fk.extent_compete_description+')',pk.extentcompetedText )>0,
	0,1))=1
ORDER BY fk.[extent_competed]


--List new [fair_opportunity_limited_s] and updated fair_opportunity_limi_desc for insertion into FPDSTypeTable.statutoryexceptiontofairopportunity
SELECT fk.[fair_opportunity_limited_s],
max(iif(fk.fair_opportunity_limi_desc=pk.statutoryexceptiontofairopportunityText or
	fk.fair_opportunity_limi_desc='' or
	charindex('('+fk.fair_opportunity_limi_desc+')',pk.statutoryexceptiontofairopportunityText )>0,
	NULL,fk.fair_opportunity_limi_desc)) as MaxOfNewFKfair_opportunity_limi_desc,
count(distinct iif(fk.fair_opportunity_limi_desc=pk.statutoryexceptiontofairopportunityText or
	fk.fair_opportunity_limi_desc='' or
	charindex('('+fk.fair_opportunity_limi_desc+')',pk.statutoryexceptiontofairopportunityText )>0,
	NULL,fk.fair_opportunity_limi_desc)) as unmatched_name_count,
pk.statutoryexceptiontofairopportunityText as PKstatutoryexceptiontofairopportunityText,
max(iif(fk.fair_opportunity_limi_desc=pk.statutoryexceptiontofairopportunityText or
	fk.fair_opportunity_limi_desc='' or
	charindex('('+fk.fair_opportunity_limi_desc+')',pk.statutoryexceptiontofairopportunityText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.statutoryexceptiontofairopportunity' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.statutoryexceptiontofairopportunity as pk
On pk.statutoryexceptiontofairopportunity=fk.[fair_opportunity_limited_s]
GROUP BY fk.[fair_opportunity_limited_s], pk.statutoryexceptiontofairopportunityText
HAVING max(iif(fk.fair_opportunity_limi_desc=pk.statutoryexceptiontofairopportunityText or
	fk.fair_opportunity_limi_desc='' or
	charindex('('+fk.fair_opportunity_limi_desc+')',pk.statutoryexceptiontofairopportunityText )>0,
	0,1))=1
ORDER BY fk.[fair_opportunity_limited_s]


--List new [fed_biz_opps] and updated fed_biz_opps_description for insertion into FPDSTypeTable.fedbizopps
SELECT fk.[fed_biz_opps],
max(iif(fk.fed_biz_opps_description=pk.fed_biz_opps_name or
	fk.fed_biz_opps_description='' or
	charindex('('+fk.fed_biz_opps_description+')',pk.fed_biz_opps_name )>0,
	NULL,fk.fed_biz_opps_description)) as MaxOfNewFKfed_biz_opps_description,
count(distinct iif(fk.fed_biz_opps_description=pk.fed_biz_opps_name or
	fk.fed_biz_opps_description='' or
	charindex('('+fk.fed_biz_opps_description+')',pk.fed_biz_opps_name )>0,
	NULL,fk.fed_biz_opps_description)) as unmatched_name_count,
pk.fed_biz_opps_name as PKfed_biz_opps_name,
max(iif(fk.fed_biz_opps_description=pk.fed_biz_opps_name or
	fk.fed_biz_opps_description='' or
	charindex('('+fk.fed_biz_opps_description+')',pk.fed_biz_opps_name )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.fedbizopps' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.fedbizopps as pk
On pk.fedbizopps=fk.[fed_biz_opps]
GROUP BY fk.[fed_biz_opps], pk.fed_biz_opps_name
HAVING max(iif(fk.fed_biz_opps_description=pk.fed_biz_opps_name or
	fk.fed_biz_opps_description='' or
	charindex('('+fk.fed_biz_opps_description+')',pk.fed_biz_opps_name )>0,
	0,1))=1
ORDER BY fk.[fed_biz_opps]


--List new [foreign_funding] and updated foreign_funding_desc for insertion into budget.FundedByForeignEntity
SELECT fk.[foreign_funding],
max(iif(fk.foreign_funding_desc=pk.foreign_funding_description or
	fk.foreign_funding_desc='' or
	charindex('('+fk.foreign_funding_desc+')',pk.foreign_funding_description )>0,
	NULL,fk.foreign_funding_desc)) as MaxOfNewFKforeign_funding_desc,
count(distinct iif(fk.foreign_funding_desc=pk.foreign_funding_description or
	fk.foreign_funding_desc='' or
	charindex('('+fk.foreign_funding_desc+')',pk.foreign_funding_description )>0,
	NULL,fk.foreign_funding_desc)) as unmatched_name_count,
pk.foreign_funding_description as PKforeign_funding_description,
max(iif(fk.foreign_funding_desc=pk.foreign_funding_description or
	fk.foreign_funding_desc='' or
	charindex('('+fk.foreign_funding_desc+')',pk.foreign_funding_description )>0,
	1,0)) as any_name_match,
'budget.FundedByForeignEntity' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN budget.FundedByForeignEntity as pk
On pk.fundedbyforeignentity=fk.[foreign_funding]
GROUP BY fk.[foreign_funding], pk.foreign_funding_description
HAVING max(iif(fk.foreign_funding_desc=pk.foreign_funding_description or
	fk.foreign_funding_desc='' or
	charindex('('+fk.foreign_funding_desc+')',pk.foreign_funding_description )>0,
	0,1))=1
ORDER BY fk.[foreign_funding]


--List new [funding_agency_code] and updated funding_agency_name for insertion into FPDSTypeTable.AgencyID
SELECT fk.[funding_agency_code],
max(iif(fk.funding_agency_name=pk.AgencyIDtext or
	fk.funding_agency_name='' or
	charindex('('+fk.funding_agency_name+')',pk.AgencyIDtext )>0,
	NULL,fk.funding_agency_name)) as MaxOfNewFKfunding_agency_name,
count(distinct iif(fk.funding_agency_name=pk.AgencyIDtext or
	fk.funding_agency_name='' or
	charindex('('+fk.funding_agency_name+')',pk.AgencyIDtext )>0,
	NULL,fk.funding_agency_name)) as unmatched_name_count,
pk.AgencyIDtext as PKAgencyIDtext,
max(iif(fk.funding_agency_name=pk.AgencyIDtext or
	fk.funding_agency_name='' or
	charindex('('+fk.funding_agency_name+')',pk.AgencyIDtext )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.AgencyID' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.AgencyID as pk
On pk.AgencyID=fk.[funding_agency_code]
GROUP BY fk.[funding_agency_code], pk.AgencyIDtext
HAVING max(iif(fk.funding_agency_name=pk.AgencyIDtext or
	fk.funding_agency_name='' or
	charindex('('+fk.funding_agency_name+')',pk.AgencyIDtext )>0,
	0,1))=1
ORDER BY fk.[funding_agency_code]


--List new [funding_sub_tier_agency_co] and updated funding_sub_tier_agency_na for insertion into FPDSTypeTable.AgencyID
SELECT fk.[funding_sub_tier_agency_co],
max(iif(fk.funding_sub_tier_agency_na=pk.AgencyIDtext or
	fk.funding_sub_tier_agency_na='' or
	charindex('('+fk.funding_sub_tier_agency_na+')',pk.AgencyIDtext )>0,
	NULL,fk.funding_sub_tier_agency_na)) as MaxOfNewFKfunding_sub_tier_agency_na,
count(distinct iif(fk.funding_sub_tier_agency_na=pk.AgencyIDtext or
	fk.funding_sub_tier_agency_na='' or
	charindex('('+fk.funding_sub_tier_agency_na+')',pk.AgencyIDtext )>0,
	NULL,fk.funding_sub_tier_agency_na)) as unmatched_name_count,
pk.AgencyIDtext as PKAgencyIDtext,
max(iif(fk.funding_sub_tier_agency_na=pk.AgencyIDtext or
	fk.funding_sub_tier_agency_na='' or
	charindex('('+fk.funding_sub_tier_agency_na+')',pk.AgencyIDtext )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.AgencyID' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.AgencyID as pk
On pk.AgencyID=fk.[funding_sub_tier_agency_co]
GROUP BY fk.[funding_sub_tier_agency_co], pk.AgencyIDtext
HAVING max(iif(fk.funding_sub_tier_agency_na=pk.AgencyIDtext or
	fk.funding_sub_tier_agency_na='' or
	charindex('('+fk.funding_sub_tier_agency_na+')',pk.AgencyIDtext )>0,
	0,1))=1
ORDER BY fk.[funding_sub_tier_agency_co]


--List new [government_furnished_prope] and updated government_furnished_desc for insertion into FPDSTypeTable.gfe_gfp
SELECT fk.[government_furnished_prope],
max(iif(fk.government_furnished_desc=pk.gfe_gfpText or
	fk.government_furnished_desc='' or
	charindex('('+fk.government_furnished_desc+')',pk.gfe_gfpText )>0,
	NULL,fk.government_furnished_desc)) as MaxOfNewFKgovernment_furnished_desc,
count(distinct iif(fk.government_furnished_desc=pk.gfe_gfpText or
	fk.government_furnished_desc='' or
	charindex('('+fk.government_furnished_desc+')',pk.gfe_gfpText )>0,
	NULL,fk.government_furnished_desc)) as unmatched_name_count,
pk.gfe_gfpText as PKgfe_gfpText,
max(iif(fk.government_furnished_desc=pk.gfe_gfpText or
	fk.government_furnished_desc='' or
	charindex('('+fk.government_furnished_desc+')',pk.gfe_gfpText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.gfe_gfp' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.gfe_gfp as pk
On pk.gfe_gfp=fk.[government_furnished_prope]
GROUP BY fk.[government_furnished_prope], pk.gfe_gfpText
HAVING max(iif(fk.government_furnished_desc=pk.gfe_gfpText or
	fk.government_furnished_desc='' or
	charindex('('+fk.government_furnished_desc+')',pk.gfe_gfpText )>0,
	0,1))=1
ORDER BY fk.[government_furnished_prope]


--List new [idv_type] and updated idv_type_description for insertion into FPDSTypeTable.idv_type_code
SELECT fk.[idv_type],
max(iif(fk.idv_type_description=pk.idv_type_name or
	fk.idv_type_description='' or
	charindex('('+fk.idv_type_description+')',pk.idv_type_name )>0,
	NULL,fk.idv_type_description)) as MaxOfNewFKidv_type_description,
count(distinct iif(fk.idv_type_description=pk.idv_type_name or
	fk.idv_type_description='' or
	charindex('('+fk.idv_type_description+')',pk.idv_type_name )>0,
	NULL,fk.idv_type_description)) as unmatched_name_count,
pk.idv_type_name as PKidv_type_name,
max(iif(fk.idv_type_description=pk.idv_type_name or
	fk.idv_type_description='' or
	charindex('('+fk.idv_type_description+')',pk.idv_type_name )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.idv_type_code' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.idv_type_code as pk
On pk.idv_type_code=fk.[idv_type]
GROUP BY fk.[idv_type], pk.idv_type_name
HAVING max(iif(fk.idv_type_description=pk.idv_type_name or
	fk.idv_type_description='' or
	charindex('('+fk.idv_type_description+')',pk.idv_type_name )>0,
	0,1))=1
ORDER BY fk.[idv_type]


--List new [information_technology_com] and updated information_technolog_desc for insertion into FPDSTypeTable.informationtechnologycommercialitemcategory
SELECT fk.[information_technology_com],
max(iif(fk.information_technolog_desc=pk.informationtechnologycommercialitemcategoryText or
	fk.information_technolog_desc='' or
	charindex('('+fk.information_technolog_desc+')',pk.informationtechnologycommercialitemcategoryText )>0,
	NULL,fk.information_technolog_desc)) as MaxOfNewFKinformation_technolog_desc,
count(distinct iif(fk.information_technolog_desc=pk.informationtechnologycommercialitemcategoryText or
	fk.information_technolog_desc='' or
	charindex('('+fk.information_technolog_desc+')',pk.informationtechnologycommercialitemcategoryText )>0,
	NULL,fk.information_technolog_desc)) as unmatched_name_count,
pk.informationtechnologycommercialitemcategoryText as PKinformationtechnologycommercialitemcategoryText,
max(iif(fk.information_technolog_desc=pk.informationtechnologycommercialitemcategoryText or
	fk.information_technolog_desc='' or
	charindex('('+fk.information_technolog_desc+')',pk.informationtechnologycommercialitemcategoryText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.informationtechnologycommercialitemcategory' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.informationtechnologycommercialitemcategory as pk
On pk.informationtechnologycommercialitemcategory=fk.[information_technology_com]
GROUP BY fk.[information_technology_com], pk.informationtechnologycommercialitemcategoryText
HAVING max(iif(fk.information_technolog_desc=pk.informationtechnologycommercialitemcategoryText or
	fk.information_technolog_desc='' or
	charindex('('+fk.information_technolog_desc+')',pk.informationtechnologycommercialitemcategoryText )>0,
	0,1))=1
ORDER BY fk.[information_technology_com]


--List new [inherently_government_func] and updated inherently_government_desc for insertion into ProductOrServiceCode.inherently_governmental_functions
SELECT fk.[inherently_government_func],
max(iif(fk.inherently_government_desc=pk.inherently_governmental_functions_description or
	fk.inherently_government_desc='' or
	charindex('('+fk.inherently_government_desc+')',pk.inherently_governmental_functions_description )>0,
	NULL,fk.inherently_government_desc)) as MaxOfNewFKinherently_government_desc,
count(distinct iif(fk.inherently_government_desc=pk.inherently_governmental_functions_description or
	fk.inherently_government_desc='' or
	charindex('('+fk.inherently_government_desc+')',pk.inherently_governmental_functions_description )>0,
	NULL,fk.inherently_government_desc)) as unmatched_name_count,
pk.inherently_governmental_functions_description as PKinherently_governmental_functions_description,
max(iif(fk.inherently_government_desc=pk.inherently_governmental_functions_description or
	fk.inherently_government_desc='' or
	charindex('('+fk.inherently_government_desc+')',pk.inherently_governmental_functions_description )>0,
	1,0)) as any_name_match,
'ProductOrServiceCode.inherently_governmental_functions' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN ProductOrServiceCode.inherently_governmental_functions as pk
On pk.inherently_governmental_functions=fk.[inherently_government_func]
GROUP BY fk.[inherently_government_func], pk.inherently_governmental_functions_description
HAVING max(iif(fk.inherently_government_desc=pk.inherently_governmental_functions_description or
	fk.inherently_government_desc='' or
	charindex('('+fk.inherently_government_desc+')',pk.inherently_governmental_functions_description )>0,
	0,1))=1
ORDER BY fk.[inherently_government_func]


--List new [interagency_contracting_au] and updated interagency_contract_desc for insertion into FPDSTypeTable.interagencycontractingauthority
SELECT fk.[interagency_contracting_au],
max(iif(fk.interagency_contract_desc=pk.interagencycontractingauthorityText or
	fk.interagency_contract_desc='' or
	charindex('('+fk.interagency_contract_desc+')',pk.interagencycontractingauthorityText )>0,
	NULL,fk.interagency_contract_desc)) as MaxOfNewFKinteragency_contract_desc,
count(distinct iif(fk.interagency_contract_desc=pk.interagencycontractingauthorityText or
	fk.interagency_contract_desc='' or
	charindex('('+fk.interagency_contract_desc+')',pk.interagencycontractingauthorityText )>0,
	NULL,fk.interagency_contract_desc)) as unmatched_name_count,
pk.interagencycontractingauthorityText as PKinteragencycontractingauthorityText,
max(iif(fk.interagency_contract_desc=pk.interagencycontractingauthorityText or
	fk.interagency_contract_desc='' or
	charindex('('+fk.interagency_contract_desc+')',pk.interagencycontractingauthorityText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.interagencycontractingauthority' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.interagencycontractingauthority as pk
On pk.interagencycontractingauthority=fk.[interagency_contracting_au]
GROUP BY fk.[interagency_contracting_au], pk.interagencycontractingauthorityText
HAVING max(iif(fk.interagency_contract_desc=pk.interagencycontractingauthorityText or
	fk.interagency_contract_desc='' or
	charindex('('+fk.interagency_contract_desc+')',pk.interagencycontractingauthorityText )>0,
	0,1))=1
ORDER BY fk.[interagency_contracting_au]


--List new [labor_standards] and updated labor_standards_descrip for insertion into FPDSTypeTable.servicecontractact
SELECT fk.[labor_standards],
max(iif(fk.labor_standards_descrip=pk.servicecontractactText or
	fk.labor_standards_descrip='' or
	charindex('('+fk.labor_standards_descrip+')',pk.servicecontractactText )>0,
	NULL,fk.labor_standards_descrip)) as MaxOfNewFKlabor_standards_descrip,
count(distinct iif(fk.labor_standards_descrip=pk.servicecontractactText or
	fk.labor_standards_descrip='' or
	charindex('('+fk.labor_standards_descrip+')',pk.servicecontractactText )>0,
	NULL,fk.labor_standards_descrip)) as unmatched_name_count,
pk.servicecontractactText as PKservicecontractactText,
max(iif(fk.labor_standards_descrip=pk.servicecontractactText or
	fk.labor_standards_descrip='' or
	charindex('('+fk.labor_standards_descrip+')',pk.servicecontractactText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.servicecontractact' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.servicecontractact as pk
On pk.servicecontractact=fk.[labor_standards]
GROUP BY fk.[labor_standards], pk.servicecontractactText
HAVING max(iif(fk.labor_standards_descrip=pk.servicecontractactText or
	fk.labor_standards_descrip='' or
	charindex('('+fk.labor_standards_descrip+')',pk.servicecontractactText )>0,
	0,1))=1
ORDER BY fk.[labor_standards]


--List new [legal_entity_county_code] for insertion into Location.County_FIPS_Code
SELECT fk.[legal_entity_county_code],
'Location.County_FIPS_Code' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Location.County_FIPS_Code as pk
On pk.county_fips_code=fk.[legal_entity_county_code]
WHERE pk.county_fips_code is NULL
GROUP BY fk.[legal_entity_county_code]
ORDER BY fk.[legal_entity_county_code]


--List new [legal_entity_state_code] and updated legal_entity_state_descrip for insertion into Location.recipient_state_code
SELECT fk.[legal_entity_state_code],
max(iif(fk.legal_entity_state_descrip=pk.recipient_state_name or
	fk.legal_entity_state_descrip='' or
	charindex('('+fk.legal_entity_state_descrip+')',pk.recipient_state_name )>0,
	NULL,fk.legal_entity_state_descrip)) as MaxOfNewFKlegal_entity_state_descrip,
count(distinct iif(fk.legal_entity_state_descrip=pk.recipient_state_name or
	fk.legal_entity_state_descrip='' or
	charindex('('+fk.legal_entity_state_descrip+')',pk.recipient_state_name )>0,
	NULL,fk.legal_entity_state_descrip)) as unmatched_name_count,
pk.recipient_state_name as PKrecipient_state_name,
max(iif(fk.legal_entity_state_descrip=pk.recipient_state_name or
	fk.legal_entity_state_descrip='' or
	charindex('('+fk.legal_entity_state_descrip+')',pk.recipient_state_name )>0,
	1,0)) as any_name_match,
'Location.recipient_state_code' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Location.recipient_state_code as pk
On pk.recipient_state_code=fk.[legal_entity_state_code]
GROUP BY fk.[legal_entity_state_code], pk.recipient_state_name
HAVING max(iif(fk.legal_entity_state_descrip=pk.recipient_state_name or
	fk.legal_entity_state_descrip='' or
	charindex('('+fk.legal_entity_state_descrip+')',pk.recipient_state_name )>0,
	0,1))=1
ORDER BY fk.[legal_entity_state_code]


--List new [local_area_set_aside] and updated local_area_set_aside_desc for insertion into Location.localareasetaside
SELECT fk.[local_area_set_aside],
max(iif(fk.local_area_set_aside_desc=pk.local_area_set_aside_name or
	fk.local_area_set_aside_desc='' or
	charindex('('+fk.local_area_set_aside_desc+')',pk.local_area_set_aside_name )>0,
	NULL,fk.local_area_set_aside_desc)) as MaxOfNewFKlocal_area_set_aside_desc,
count(distinct iif(fk.local_area_set_aside_desc=pk.local_area_set_aside_name or
	fk.local_area_set_aside_desc='' or
	charindex('('+fk.local_area_set_aside_desc+')',pk.local_area_set_aside_name )>0,
	NULL,fk.local_area_set_aside_desc)) as unmatched_name_count,
pk.local_area_set_aside_name as PKlocal_area_set_aside_name,
max(iif(fk.local_area_set_aside_desc=pk.local_area_set_aside_name or
	fk.local_area_set_aside_desc='' or
	charindex('('+fk.local_area_set_aside_desc+')',pk.local_area_set_aside_name )>0,
	1,0)) as any_name_match,
'Location.localareasetaside' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Location.localareasetaside as pk
On pk.localareasetaside=fk.[local_area_set_aside]
GROUP BY fk.[local_area_set_aside], pk.local_area_set_aside_name
HAVING max(iif(fk.local_area_set_aside_desc=pk.local_area_set_aside_name or
	fk.local_area_set_aside_desc='' or
	charindex('('+fk.local_area_set_aside_desc+')',pk.local_area_set_aside_name )>0,
	0,1))=1
ORDER BY fk.[local_area_set_aside]


--List new [major_program] for insertion into Contract.MajorProgramCode
SELECT fk.[major_program],
'Contract.MajorProgramCode' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Contract.MajorProgramCode as pk
On pk.majorprogramcode=fk.[major_program]
WHERE pk.majorprogramcode is NULL
GROUP BY fk.[major_program]
ORDER BY fk.[major_program]


--List new [materials_supplies_article] and updated materials_supplies_descrip for insertion into FPDSTypeTable.walshhealyact
SELECT fk.[materials_supplies_article],
max(iif(fk.materials_supplies_descrip=pk.walshhealyactText or
	fk.materials_supplies_descrip='' or
	charindex('('+fk.materials_supplies_descrip+')',pk.walshhealyactText )>0,
	NULL,fk.materials_supplies_descrip)) as MaxOfNewFKmaterials_supplies_descrip,
count(distinct iif(fk.materials_supplies_descrip=pk.walshhealyactText or
	fk.materials_supplies_descrip='' or
	charindex('('+fk.materials_supplies_descrip+')',pk.walshhealyactText )>0,
	NULL,fk.materials_supplies_descrip)) as unmatched_name_count,
pk.walshhealyactText as PKwalshhealyactText,
max(iif(fk.materials_supplies_descrip=pk.walshhealyactText or
	fk.materials_supplies_descrip='' or
	charindex('('+fk.materials_supplies_descrip+')',pk.walshhealyactText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.walshhealyact' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.walshhealyact as pk
On pk.walshhealyact=fk.[materials_supplies_article]
GROUP BY fk.[materials_supplies_article], pk.walshhealyactText
HAVING max(iif(fk.materials_supplies_descrip=pk.walshhealyactText or
	fk.materials_supplies_descrip='' or
	charindex('('+fk.materials_supplies_descrip+')',pk.walshhealyactText )>0,
	0,1))=1
ORDER BY fk.[materials_supplies_article]


--List new [multiple_or_single_award_i] and updated multiple_or_single_aw_desc for insertion into FPDSTypeTable.multipleorsingleawardidc
SELECT fk.[multiple_or_single_award_i],
max(iif(fk.multiple_or_single_aw_desc=pk.multipleorsingleawardidcText or
	fk.multiple_or_single_aw_desc='' or
	charindex('('+fk.multiple_or_single_aw_desc+')',pk.multipleorsingleawardidcText )>0,
	NULL,fk.multiple_or_single_aw_desc)) as MaxOfNewFKmultiple_or_single_aw_desc,
count(distinct iif(fk.multiple_or_single_aw_desc=pk.multipleorsingleawardidcText or
	fk.multiple_or_single_aw_desc='' or
	charindex('('+fk.multiple_or_single_aw_desc+')',pk.multipleorsingleawardidcText )>0,
	NULL,fk.multiple_or_single_aw_desc)) as unmatched_name_count,
pk.multipleorsingleawardidcText as PKmultipleorsingleawardidcText,
max(iif(fk.multiple_or_single_aw_desc=pk.multipleorsingleawardidcText or
	fk.multiple_or_single_aw_desc='' or
	charindex('('+fk.multiple_or_single_aw_desc+')',pk.multipleorsingleawardidcText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.multipleorsingleawardidc' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.multipleorsingleawardidc as pk
On pk.multipleorsingleawardidc=fk.[multiple_or_single_award_i]
GROUP BY fk.[multiple_or_single_award_i], pk.multipleorsingleawardidcText
HAVING max(iif(fk.multiple_or_single_aw_desc=pk.multipleorsingleawardidcText or
	fk.multiple_or_single_aw_desc='' or
	charindex('('+fk.multiple_or_single_aw_desc+')',pk.multipleorsingleawardidcText )>0,
	0,1))=1
ORDER BY fk.[multiple_or_single_award_i]


--List new [naics] and updated naics_description for insertion into FPDSTypeTable.PrincipalNaicsCode
SELECT fk.[naics],
max(iif(fk.naics_description=pk.principalnaicscodeText or
	fk.naics_description='' or
	charindex('('+fk.naics_description+')',pk.principalnaicscodeText )>0,
	NULL,fk.naics_description)) as MaxOfNewFKnaics_description,
count(distinct iif(fk.naics_description=pk.principalnaicscodeText or
	fk.naics_description='' or
	charindex('('+fk.naics_description+')',pk.principalnaicscodeText )>0,
	NULL,fk.naics_description)) as unmatched_name_count,
pk.principalnaicscodeText as PKprincipalnaicscodeText,
max(iif(fk.naics_description=pk.principalnaicscodeText or
	fk.naics_description='' or
	charindex('('+fk.naics_description+')',pk.principalnaicscodeText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.PrincipalNaicsCode' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.PrincipalNaicsCode as pk
On pk.principalnaicscode=fk.[naics]
GROUP BY fk.[naics], pk.principalnaicscodeText
HAVING max(iif(fk.naics_description=pk.principalnaicscodeText or
	fk.naics_description='' or
	charindex('('+fk.naics_description+')',pk.principalnaicscodeText )>0,
	0,1))=1
ORDER BY fk.[naics]


--List new [national_interest_action] and updated national_interest_desc for insertion into Assistance.NationalInterestActionCode
SELECT fk.[national_interest_action],
max(iif(fk.national_interest_desc=pk.National_Interest_Action_Name or
	fk.national_interest_desc='' or
	charindex('('+fk.national_interest_desc+')',pk.National_Interest_Action_Name )>0,
	NULL,fk.national_interest_desc)) as MaxOfNewFKnational_interest_desc,
count(distinct iif(fk.national_interest_desc=pk.National_Interest_Action_Name or
	fk.national_interest_desc='' or
	charindex('('+fk.national_interest_desc+')',pk.National_Interest_Action_Name )>0,
	NULL,fk.national_interest_desc)) as unmatched_name_count,
pk.National_Interest_Action_Name as PKNational_Interest_Action_Name,
max(iif(fk.national_interest_desc=pk.National_Interest_Action_Name or
	fk.national_interest_desc='' or
	charindex('('+fk.national_interest_desc+')',pk.National_Interest_Action_Name )>0,
	1,0)) as any_name_match,
'Assistance.NationalInterestActionCode' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Assistance.NationalInterestActionCode as pk
On pk.NationalInterestActionCode=fk.[national_interest_action]
GROUP BY fk.[national_interest_action], pk.National_Interest_Action_Name
HAVING max(iif(fk.national_interest_desc=pk.National_Interest_Action_Name or
	fk.national_interest_desc='' or
	charindex('('+fk.national_interest_desc+')',pk.National_Interest_Action_Name )>0,
	0,1))=1
ORDER BY fk.[national_interest_action]


--List new [organizational_type] for insertion into Vendor.OrganizationalType
SELECT fk.[organizational_type],
'Vendor.OrganizationalType' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Vendor.OrganizationalType as pk
On pk.OrganizationalType=fk.[organizational_type]
WHERE pk.OrganizationalType is NULL
GROUP BY fk.[organizational_type]
ORDER BY fk.[organizational_type]


--List new [other_than_full_and_open_c] and updated other_than_full_and_o_desc for insertion into FPDSTypeTable.reasonnotcompeted
SELECT fk.[other_than_full_and_open_c],
max(iif(fk.other_than_full_and_o_desc=pk.reasonnotcompetedText or
	fk.other_than_full_and_o_desc='' or
	charindex('('+fk.other_than_full_and_o_desc+')',pk.reasonnotcompetedText )>0,
	NULL,fk.other_than_full_and_o_desc)) as MaxOfNewFKother_than_full_and_o_desc,
count(distinct iif(fk.other_than_full_and_o_desc=pk.reasonnotcompetedText or
	fk.other_than_full_and_o_desc='' or
	charindex('('+fk.other_than_full_and_o_desc+')',pk.reasonnotcompetedText )>0,
	NULL,fk.other_than_full_and_o_desc)) as unmatched_name_count,
pk.reasonnotcompetedText as PKreasonnotcompetedText,
max(iif(fk.other_than_full_and_o_desc=pk.reasonnotcompetedText or
	fk.other_than_full_and_o_desc='' or
	charindex('('+fk.other_than_full_and_o_desc+')',pk.reasonnotcompetedText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.reasonnotcompeted' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.reasonnotcompeted as pk
On pk.reasonnotcompeted=fk.[other_than_full_and_open_c]
GROUP BY fk.[other_than_full_and_open_c], pk.reasonnotcompetedText
HAVING max(iif(fk.other_than_full_and_o_desc=pk.reasonnotcompetedText or
	fk.other_than_full_and_o_desc='' or
	charindex('('+fk.other_than_full_and_o_desc+')',pk.reasonnotcompetedText )>0,
	0,1))=1
ORDER BY fk.[other_than_full_and_open_c]


--List new [performance_based_service] and updated performance_based_se_desc for insertion into FPDSTypeTable.PerformanceBasedServiceContract
SELECT fk.[performance_based_service],
max(iif(fk.performance_based_se_desc=pk.performancebasedservicecontractText or
	fk.performance_based_se_desc='' or
	charindex('('+fk.performance_based_se_desc+')',pk.performancebasedservicecontractText )>0,
	NULL,fk.performance_based_se_desc)) as MaxOfNewFKperformance_based_se_desc,
count(distinct iif(fk.performance_based_se_desc=pk.performancebasedservicecontractText or
	fk.performance_based_se_desc='' or
	charindex('('+fk.performance_based_se_desc+')',pk.performancebasedservicecontractText )>0,
	NULL,fk.performance_based_se_desc)) as unmatched_name_count,
pk.performancebasedservicecontractText as PKperformancebasedservicecontractText,
max(iif(fk.performance_based_se_desc=pk.performancebasedservicecontractText or
	fk.performance_based_se_desc='' or
	charindex('('+fk.performance_based_se_desc+')',pk.performancebasedservicecontractText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.PerformanceBasedServiceContract' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.PerformanceBasedServiceContract as pk
On pk.performancebasedservicecontract=fk.[performance_based_service]
GROUP BY fk.[performance_based_service], pk.performancebasedservicecontractText
HAVING max(iif(fk.performance_based_se_desc=pk.performancebasedservicecontractText or
	fk.performance_based_se_desc='' or
	charindex('('+fk.performance_based_se_desc+')',pk.performancebasedservicecontractText )>0,
	0,1))=1
ORDER BY fk.[performance_based_service]


--List new [place_of_manufacture] and updated place_of_manufacture_desc for insertion into FPDSTypeTable.PlaceOfManufacture
SELECT fk.[place_of_manufacture],
max(iif(fk.place_of_manufacture_desc=pk.PlaceOfManufactureText or
	fk.place_of_manufacture_desc='' or
	charindex('('+fk.place_of_manufacture_desc+')',pk.PlaceOfManufactureText )>0,
	NULL,fk.place_of_manufacture_desc)) as MaxOfNewFKplace_of_manufacture_desc,
count(distinct iif(fk.place_of_manufacture_desc=pk.PlaceOfManufactureText or
	fk.place_of_manufacture_desc='' or
	charindex('('+fk.place_of_manufacture_desc+')',pk.PlaceOfManufactureText )>0,
	NULL,fk.place_of_manufacture_desc)) as unmatched_name_count,
pk.PlaceOfManufactureText as PKPlaceOfManufactureText,
max(iif(fk.place_of_manufacture_desc=pk.PlaceOfManufactureText or
	fk.place_of_manufacture_desc='' or
	charindex('('+fk.place_of_manufacture_desc+')',pk.PlaceOfManufactureText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.PlaceOfManufacture' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.PlaceOfManufacture as pk
On pk.PlaceOfManufacture=fk.[place_of_manufacture]
GROUP BY fk.[place_of_manufacture], pk.PlaceOfManufactureText
HAVING max(iif(fk.place_of_manufacture_desc=pk.PlaceOfManufactureText or
	fk.place_of_manufacture_desc='' or
	charindex('('+fk.place_of_manufacture_desc+')',pk.PlaceOfManufactureText )>0,
	0,1))=1
ORDER BY fk.[place_of_manufacture]


--List new [place_of_perform_country_c] and updated place_of_perf_country_desc for insertion into FPDSTypeTable.Country3LetterCode
SELECT fk.[place_of_perform_country_c],
max(iif(fk.place_of_perf_country_desc=pk.Country3LetterCodeText or
	fk.place_of_perf_country_desc='' or
	charindex('('+fk.place_of_perf_country_desc+')',pk.Country3LetterCodeText )>0,
	NULL,fk.place_of_perf_country_desc)) as MaxOfNewFKplace_of_perf_country_desc,
count(distinct iif(fk.place_of_perf_country_desc=pk.Country3LetterCodeText or
	fk.place_of_perf_country_desc='' or
	charindex('('+fk.place_of_perf_country_desc+')',pk.Country3LetterCodeText )>0,
	NULL,fk.place_of_perf_country_desc)) as unmatched_name_count,
pk.Country3LetterCodeText as PKCountry3LetterCodeText,
max(iif(fk.place_of_perf_country_desc=pk.Country3LetterCodeText or
	fk.place_of_perf_country_desc='' or
	charindex('('+fk.place_of_perf_country_desc+')',pk.Country3LetterCodeText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.Country3LetterCode' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.Country3LetterCode as pk
On pk.Country3LetterCode=fk.[place_of_perform_country_c]
GROUP BY fk.[place_of_perform_country_c], pk.Country3LetterCodeText
HAVING max(iif(fk.place_of_perf_country_desc=pk.Country3LetterCodeText or
	fk.place_of_perf_country_desc='' or
	charindex('('+fk.place_of_perf_country_desc+')',pk.Country3LetterCodeText )>0,
	0,1))=1
ORDER BY fk.[place_of_perform_country_c]


--List new [place_of_perform_county_co] for insertion into Location.County_FIPS_Code
SELECT fk.[place_of_perform_county_co],
'Location.County_FIPS_Code' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Location.County_FIPS_Code as pk
On pk.county_fips_code=fk.[place_of_perform_county_co]
WHERE pk.county_fips_code is NULL
GROUP BY fk.[place_of_perform_county_co]
ORDER BY fk.[place_of_perform_county_co]


--List new [place_of_performance_state] and updated place_of_perfor_state_desc for insertion into FPDSTypeTable.statecode
SELECT fk.[place_of_performance_state],
max(iif(fk.place_of_perfor_state_desc=pk.statecodeText or
	fk.place_of_perfor_state_desc='' or
	charindex('('+fk.place_of_perfor_state_desc+')',pk.statecodeText )>0,
	NULL,fk.place_of_perfor_state_desc)) as MaxOfNewFKplace_of_perfor_state_desc,
count(distinct iif(fk.place_of_perfor_state_desc=pk.statecodeText or
	fk.place_of_perfor_state_desc='' or
	charindex('('+fk.place_of_perfor_state_desc+')',pk.statecodeText )>0,
	NULL,fk.place_of_perfor_state_desc)) as unmatched_name_count,
pk.statecodeText as PKstatecodeText,
max(iif(fk.place_of_perfor_state_desc=pk.statecodeText or
	fk.place_of_perfor_state_desc='' or
	charindex('('+fk.place_of_perfor_state_desc+')',pk.statecodeText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.statecode' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.statecode as pk
On pk.statecode=fk.[place_of_performance_state]
GROUP BY fk.[place_of_performance_state], pk.statecodeText
HAVING max(iif(fk.place_of_perfor_state_desc=pk.statecodeText or
	fk.place_of_perfor_state_desc='' or
	charindex('('+fk.place_of_perfor_state_desc+')',pk.statecodeText )>0,
	0,1))=1
ORDER BY fk.[place_of_performance_state]


--List new [product_or_service_code] and updated product_or_service_co_desc for insertion into FPDSTypeTable.ProductOrServiceCode
SELECT fk.[product_or_service_code],
max(iif(fk.product_or_service_co_desc=pk.ProductOrServiceCodeText or
	fk.product_or_service_co_desc='' or
	charindex('('+fk.product_or_service_co_desc+')',pk.ProductOrServiceCodeText )>0,
	NULL,fk.product_or_service_co_desc)) as MaxOfNewFKproduct_or_service_co_desc,
count(distinct iif(fk.product_or_service_co_desc=pk.ProductOrServiceCodeText or
	fk.product_or_service_co_desc='' or
	charindex('('+fk.product_or_service_co_desc+')',pk.ProductOrServiceCodeText )>0,
	NULL,fk.product_or_service_co_desc)) as unmatched_name_count,
pk.ProductOrServiceCodeText as PKProductOrServiceCodeText,
max(iif(fk.product_or_service_co_desc=pk.ProductOrServiceCodeText or
	fk.product_or_service_co_desc='' or
	charindex('('+fk.product_or_service_co_desc+')',pk.ProductOrServiceCodeText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.ProductOrServiceCode' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.ProductOrServiceCode as pk
On pk.ProductOrServiceCode=fk.[product_or_service_code]
GROUP BY fk.[product_or_service_code], pk.ProductOrServiceCodeText
HAVING max(iif(fk.product_or_service_co_desc=pk.ProductOrServiceCodeText or
	fk.product_or_service_co_desc='' or
	charindex('('+fk.product_or_service_co_desc+')',pk.ProductOrServiceCodeText )>0,
	0,1))=1
ORDER BY fk.[product_or_service_code]


--List new [program_system_or_equipmen] and updated program_system_or_equ_desc for insertion into Project.SystemEquipmentCode
SELECT fk.[program_system_or_equipmen],
max(iif(fk.program_system_or_equ_desc=pk.systemequipmentcodeText or
	fk.program_system_or_equ_desc='' or
	charindex('('+fk.program_system_or_equ_desc+')',pk.systemequipmentcodeText )>0,
	NULL,fk.program_system_or_equ_desc)) as MaxOfNewFKprogram_system_or_equ_desc,
count(distinct iif(fk.program_system_or_equ_desc=pk.systemequipmentcodeText or
	fk.program_system_or_equ_desc='' or
	charindex('('+fk.program_system_or_equ_desc+')',pk.systemequipmentcodeText )>0,
	NULL,fk.program_system_or_equ_desc)) as unmatched_name_count,
pk.systemequipmentcodeText as PKsystemequipmentcodeText,
max(iif(fk.program_system_or_equ_desc=pk.systemequipmentcodeText or
	fk.program_system_or_equ_desc='' or
	charindex('('+fk.program_system_or_equ_desc+')',pk.systemequipmentcodeText )>0,
	1,0)) as any_name_match,
'Project.SystemEquipmentCode' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Project.SystemEquipmentCode as pk
On pk.systemequipmentcode=fk.[program_system_or_equipmen]
GROUP BY fk.[program_system_or_equipmen], pk.systemequipmentcodeText
HAVING max(iif(fk.program_system_or_equ_desc=pk.systemequipmentcodeText or
	fk.program_system_or_equ_desc='' or
	charindex('('+fk.program_system_or_equ_desc+')',pk.systemequipmentcodeText )>0,
	0,1))=1
ORDER BY fk.[program_system_or_equipmen]


--List new [recovered_materials_sustai] and updated recovered_materials_s_desc for insertion into FPDSTypeTable.recoveredmaterialclauses
SELECT fk.[recovered_materials_sustai],
max(iif(fk.recovered_materials_s_desc=pk.recoveredmaterialclausesText or
	fk.recovered_materials_s_desc='' or
	charindex('('+fk.recovered_materials_s_desc+')',pk.recoveredmaterialclausesText )>0,
	NULL,fk.recovered_materials_s_desc)) as MaxOfNewFKrecovered_materials_s_desc,
count(distinct iif(fk.recovered_materials_s_desc=pk.recoveredmaterialclausesText or
	fk.recovered_materials_s_desc='' or
	charindex('('+fk.recovered_materials_s_desc+')',pk.recoveredmaterialclausesText )>0,
	NULL,fk.recovered_materials_s_desc)) as unmatched_name_count,
pk.recoveredmaterialclausesText as PKrecoveredmaterialclausesText,
max(iif(fk.recovered_materials_s_desc=pk.recoveredmaterialclausesText or
	fk.recovered_materials_s_desc='' or
	charindex('('+fk.recovered_materials_s_desc+')',pk.recoveredmaterialclausesText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.recoveredmaterialclauses' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.recoveredmaterialclauses as pk
On pk.recoveredmaterialclauses=fk.[recovered_materials_sustai]
GROUP BY fk.[recovered_materials_sustai], pk.recoveredmaterialclausesText
HAVING max(iif(fk.recovered_materials_s_desc=pk.recoveredmaterialclausesText or
	fk.recovered_materials_s_desc='' or
	charindex('('+fk.recovered_materials_s_desc+')',pk.recoveredmaterialclausesText )>0,
	0,1))=1
ORDER BY fk.[recovered_materials_sustai]


--List new [referenced_idv_agency_iden] and updated referenced_idv_agency_desc for insertion into FPDSTypeTable.AgencyID
SELECT fk.[referenced_idv_agency_iden],
max(iif(fk.referenced_idv_agency_desc=pk.AgencyIDtext or
	fk.referenced_idv_agency_desc='' or
	charindex('('+fk.referenced_idv_agency_desc+')',pk.AgencyIDtext )>0,
	NULL,fk.referenced_idv_agency_desc)) as MaxOfNewFKreferenced_idv_agency_desc,
count(distinct iif(fk.referenced_idv_agency_desc=pk.AgencyIDtext or
	fk.referenced_idv_agency_desc='' or
	charindex('('+fk.referenced_idv_agency_desc+')',pk.AgencyIDtext )>0,
	NULL,fk.referenced_idv_agency_desc)) as unmatched_name_count,
pk.AgencyIDtext as PKAgencyIDtext,
max(iif(fk.referenced_idv_agency_desc=pk.AgencyIDtext or
	fk.referenced_idv_agency_desc='' or
	charindex('('+fk.referenced_idv_agency_desc+')',pk.AgencyIDtext )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.AgencyID' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.AgencyID as pk
On pk.AgencyID=fk.[referenced_idv_agency_iden]
GROUP BY fk.[referenced_idv_agency_iden], pk.AgencyIDtext
HAVING max(iif(fk.referenced_idv_agency_desc=pk.AgencyIDtext or
	fk.referenced_idv_agency_desc='' or
	charindex('('+fk.referenced_idv_agency_desc+')',pk.AgencyIDtext )>0,
	0,1))=1
ORDER BY fk.[referenced_idv_agency_iden]


--List new [referenced_idv_type] and updated referenced_idv_type_desc for insertion into FPDSTypeTable.idv_type_code
SELECT fk.[referenced_idv_type],
max(iif(fk.referenced_idv_type_desc=pk.idv_type_name or
	fk.referenced_idv_type_desc='' or
	charindex('('+fk.referenced_idv_type_desc+')',pk.idv_type_name )>0,
	NULL,fk.referenced_idv_type_desc)) as MaxOfNewFKreferenced_idv_type_desc,
count(distinct iif(fk.referenced_idv_type_desc=pk.idv_type_name or
	fk.referenced_idv_type_desc='' or
	charindex('('+fk.referenced_idv_type_desc+')',pk.idv_type_name )>0,
	NULL,fk.referenced_idv_type_desc)) as unmatched_name_count,
pk.idv_type_name as PKidv_type_name,
max(iif(fk.referenced_idv_type_desc=pk.idv_type_name or
	fk.referenced_idv_type_desc='' or
	charindex('('+fk.referenced_idv_type_desc+')',pk.idv_type_name )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.idv_type_code' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.idv_type_code as pk
On pk.idv_type_code=fk.[referenced_idv_type]
GROUP BY fk.[referenced_idv_type], pk.idv_type_name
HAVING max(iif(fk.referenced_idv_type_desc=pk.idv_type_name or
	fk.referenced_idv_type_desc='' or
	charindex('('+fk.referenced_idv_type_desc+')',pk.idv_type_name )>0,
	0,1))=1
ORDER BY fk.[referenced_idv_type]


--List new [referenced_mult_or_single] and updated referenced_mult_or_si_desc for insertion into FPDSTypeTable.multipleorsingleawardidc
SELECT fk.[referenced_mult_or_single],
max(iif(fk.referenced_mult_or_si_desc=pk.multipleorsingleawardidcText or
	fk.referenced_mult_or_si_desc='' or
	charindex('('+fk.referenced_mult_or_si_desc+')',pk.multipleorsingleawardidcText )>0,
	NULL,fk.referenced_mult_or_si_desc)) as MaxOfNewFKreferenced_mult_or_si_desc,
count(distinct iif(fk.referenced_mult_or_si_desc=pk.multipleorsingleawardidcText or
	fk.referenced_mult_or_si_desc='' or
	charindex('('+fk.referenced_mult_or_si_desc+')',pk.multipleorsingleawardidcText )>0,
	NULL,fk.referenced_mult_or_si_desc)) as unmatched_name_count,
pk.multipleorsingleawardidcText as PKmultipleorsingleawardidcText,
max(iif(fk.referenced_mult_or_si_desc=pk.multipleorsingleawardidcText or
	fk.referenced_mult_or_si_desc='' or
	charindex('('+fk.referenced_mult_or_si_desc+')',pk.multipleorsingleawardidcText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.multipleorsingleawardidc' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.multipleorsingleawardidc as pk
On pk.multipleorsingleawardidc=fk.[referenced_mult_or_single]
GROUP BY fk.[referenced_mult_or_single], pk.multipleorsingleawardidcText
HAVING max(iif(fk.referenced_mult_or_si_desc=pk.multipleorsingleawardidcText or
	fk.referenced_mult_or_si_desc='' or
	charindex('('+fk.referenced_mult_or_si_desc+')',pk.multipleorsingleawardidcText )>0,
	0,1))=1
ORDER BY fk.[referenced_mult_or_single]


--List new [research] and updated research_description for insertion into ProductOrServiceCode.Research_Code
SELECT fk.[research],
max(iif(fk.research_description=pk.Research_Name or
	fk.research_description='' or
	charindex('('+fk.research_description+')',pk.Research_Name )>0,
	NULL,fk.research_description)) as MaxOfNewFKresearch_description,
count(distinct iif(fk.research_description=pk.Research_Name or
	fk.research_description='' or
	charindex('('+fk.research_description+')',pk.Research_Name )>0,
	NULL,fk.research_description)) as unmatched_name_count,
pk.Research_Name as PKResearch_Name,
max(iif(fk.research_description=pk.Research_Name or
	fk.research_description='' or
	charindex('('+fk.research_description+')',pk.Research_Name )>0,
	1,0)) as any_name_match,
'ProductOrServiceCode.Research_Code' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN ProductOrServiceCode.Research_Code as pk
On pk.Research_Code=fk.[research]
GROUP BY fk.[research], pk.Research_Name
HAVING max(iif(fk.research_description=pk.Research_Name or
	fk.research_description='' or
	charindex('('+fk.research_description+')',pk.Research_Name )>0,
	0,1))=1
ORDER BY fk.[research]


--List new [sam_exception] and updated sam_exception_description for insertion into Vendor.CCRexception
SELECT fk.[sam_exception],
max(iif(fk.sam_exception_description=pk.sam_exception_description or
	fk.sam_exception_description='' or
	charindex('('+fk.sam_exception_description+')',pk.sam_exception_description )>0,
	NULL,fk.sam_exception_description)) as MaxOfNewFKsam_exception_description,
count(distinct iif(fk.sam_exception_description=pk.sam_exception_description or
	fk.sam_exception_description='' or
	charindex('('+fk.sam_exception_description+')',pk.sam_exception_description )>0,
	NULL,fk.sam_exception_description)) as unmatched_name_count,
pk.sam_exception_description as PKsam_exception_description,
max(iif(fk.sam_exception_description=pk.sam_exception_description or
	fk.sam_exception_description='' or
	charindex('('+fk.sam_exception_description+')',pk.sam_exception_description )>0,
	1,0)) as any_name_match,
'Vendor.CCRexception' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Vendor.CCRexception as pk
On pk.CCRexception=fk.[sam_exception]
GROUP BY fk.[sam_exception], pk.sam_exception_description
HAVING max(iif(fk.sam_exception_description=pk.sam_exception_description or
	fk.sam_exception_description='' or
	charindex('('+fk.sam_exception_description+')',pk.sam_exception_description )>0,
	0,1))=1
ORDER BY fk.[sam_exception]


--List new [sea_transportation] and updated sea_transportation_desc for insertion into FPDSTypeTable.seatransportation
SELECT fk.[sea_transportation],
max(iif(fk.sea_transportation_desc=pk.seatransportationText or
	fk.sea_transportation_desc='' or
	charindex('('+fk.sea_transportation_desc+')',pk.seatransportationText )>0,
	NULL,fk.sea_transportation_desc)) as MaxOfNewFKsea_transportation_desc,
count(distinct iif(fk.sea_transportation_desc=pk.seatransportationText or
	fk.sea_transportation_desc='' or
	charindex('('+fk.sea_transportation_desc+')',pk.seatransportationText )>0,
	NULL,fk.sea_transportation_desc)) as unmatched_name_count,
pk.seatransportationText as PKseatransportationText,
max(iif(fk.sea_transportation_desc=pk.seatransportationText or
	fk.sea_transportation_desc='' or
	charindex('('+fk.sea_transportation_desc+')',pk.seatransportationText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.seatransportation' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.seatransportation as pk
On pk.seatransportation=fk.[sea_transportation]
GROUP BY fk.[sea_transportation], pk.seatransportationText
HAVING max(iif(fk.sea_transportation_desc=pk.seatransportationText or
	fk.sea_transportation_desc='' or
	charindex('('+fk.sea_transportation_desc+')',pk.seatransportationText )>0,
	0,1))=1
ORDER BY fk.[sea_transportation]


--List new [solicitation_procedures] and updated solicitation_procedur_desc for insertion into FPDSTypeTable.solicitationprocedures
SELECT fk.[solicitation_procedures],
max(iif(fk.solicitation_procedur_desc=pk.solicitationproceduresText or
	fk.solicitation_procedur_desc='' or
	charindex('('+fk.solicitation_procedur_desc+')',pk.solicitationproceduresText )>0,
	NULL,fk.solicitation_procedur_desc)) as MaxOfNewFKsolicitation_procedur_desc,
count(distinct iif(fk.solicitation_procedur_desc=pk.solicitationproceduresText or
	fk.solicitation_procedur_desc='' or
	charindex('('+fk.solicitation_procedur_desc+')',pk.solicitationproceduresText )>0,
	NULL,fk.solicitation_procedur_desc)) as unmatched_name_count,
pk.solicitationproceduresText as PKsolicitationproceduresText,
max(iif(fk.solicitation_procedur_desc=pk.solicitationproceduresText or
	fk.solicitation_procedur_desc='' or
	charindex('('+fk.solicitation_procedur_desc+')',pk.solicitationproceduresText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.solicitationprocedures' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.solicitationprocedures as pk
On pk.solicitationprocedures=fk.[solicitation_procedures]
GROUP BY fk.[solicitation_procedures], pk.solicitationproceduresText
HAVING max(iif(fk.solicitation_procedur_desc=pk.solicitationproceduresText or
	fk.solicitation_procedur_desc='' or
	charindex('('+fk.solicitation_procedur_desc+')',pk.solicitationproceduresText )>0,
	0,1))=1
ORDER BY fk.[solicitation_procedures]


--List new [subcontracting_plan] and updated subcontracting_plan_desc for insertion into FPDSTypeTable.subcontractplan
SELECT fk.[subcontracting_plan],
max(iif(fk.subcontracting_plan_desc=pk.subcontractplanText or
	fk.subcontracting_plan_desc='' or
	charindex('('+fk.subcontracting_plan_desc+')',pk.subcontractplanText )>0,
	NULL,fk.subcontracting_plan_desc)) as MaxOfNewFKsubcontracting_plan_desc,
count(distinct iif(fk.subcontracting_plan_desc=pk.subcontractplanText or
	fk.subcontracting_plan_desc='' or
	charindex('('+fk.subcontracting_plan_desc+')',pk.subcontractplanText )>0,
	NULL,fk.subcontracting_plan_desc)) as unmatched_name_count,
pk.subcontractplanText as PKsubcontractplanText,
max(iif(fk.subcontracting_plan_desc=pk.subcontractplanText or
	fk.subcontracting_plan_desc='' or
	charindex('('+fk.subcontracting_plan_desc+')',pk.subcontractplanText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.subcontractplan' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.subcontractplan as pk
On pk.subcontractplan=fk.[subcontracting_plan]
GROUP BY fk.[subcontracting_plan], pk.subcontractplanText
HAVING max(iif(fk.subcontracting_plan_desc=pk.subcontractplanText or
	fk.subcontracting_plan_desc='' or
	charindex('('+fk.subcontracting_plan_desc+')',pk.subcontractplanText )>0,
	0,1))=1
ORDER BY fk.[subcontracting_plan]


--List new [type_of_contract_pricing] and updated type_of_contract_pric_desc for insertion into FPDSTypeTable.typeofcontractpricing
SELECT fk.[type_of_contract_pricing],
max(iif(fk.type_of_contract_pric_desc=pk.TypeOfContractPricingText or
	fk.type_of_contract_pric_desc='' or
	charindex('('+fk.type_of_contract_pric_desc+')',pk.TypeOfContractPricingText )>0,
	NULL,fk.type_of_contract_pric_desc)) as MaxOfNewFKtype_of_contract_pric_desc,
count(distinct iif(fk.type_of_contract_pric_desc=pk.TypeOfContractPricingText or
	fk.type_of_contract_pric_desc='' or
	charindex('('+fk.type_of_contract_pric_desc+')',pk.TypeOfContractPricingText )>0,
	NULL,fk.type_of_contract_pric_desc)) as unmatched_name_count,
pk.TypeOfContractPricingText as PKTypeOfContractPricingText,
max(iif(fk.type_of_contract_pric_desc=pk.TypeOfContractPricingText or
	fk.type_of_contract_pric_desc='' or
	charindex('('+fk.type_of_contract_pric_desc+')',pk.TypeOfContractPricingText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.typeofcontractpricing' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.typeofcontractpricing as pk
On pk.TypeOfContractPricing=fk.[type_of_contract_pricing]
GROUP BY fk.[type_of_contract_pricing], pk.TypeOfContractPricingText
HAVING max(iif(fk.type_of_contract_pric_desc=pk.TypeOfContractPricingText or
	fk.type_of_contract_pric_desc='' or
	charindex('('+fk.type_of_contract_pric_desc+')',pk.TypeOfContractPricingText )>0,
	0,1))=1
ORDER BY fk.[type_of_contract_pricing]


--List new [type_of_idc] and updated type_of_idc_description for insertion into FPDSTypeTable.TypeOfIDC
SELECT fk.[type_of_idc],
max(iif(fk.type_of_idc_description=pk.typeOfIDCdescription or
	fk.type_of_idc_description='' or
	charindex('('+fk.type_of_idc_description+')',pk.typeOfIDCdescription )>0,
	NULL,fk.type_of_idc_description)) as MaxOfNewFKtype_of_idc_description,
count(distinct iif(fk.type_of_idc_description=pk.typeOfIDCdescription or
	fk.type_of_idc_description='' or
	charindex('('+fk.type_of_idc_description+')',pk.typeOfIDCdescription )>0,
	NULL,fk.type_of_idc_description)) as unmatched_name_count,
pk.typeOfIDCdescription as PKtypeOfIDCdescription,
max(iif(fk.type_of_idc_description=pk.typeOfIDCdescription or
	fk.type_of_idc_description='' or
	charindex('('+fk.type_of_idc_description+')',pk.typeOfIDCdescription )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.TypeOfIDC' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.TypeOfIDC as pk
On pk.typeofIDC=fk.[type_of_idc]
GROUP BY fk.[type_of_idc], pk.typeOfIDCdescription
HAVING max(iif(fk.type_of_idc_description=pk.typeOfIDCdescription or
	fk.type_of_idc_description='' or
	charindex('('+fk.type_of_idc_description+')',pk.typeOfIDCdescription )>0,
	0,1))=1
ORDER BY fk.[type_of_idc]


--List new [type_set_aside] and updated type_set_aside_description for insertion into FPDSTypeTable.typeofsetaside
SELECT fk.[type_set_aside],
max(iif(fk.type_set_aside_description=pk.typeofsetasideText or
	fk.type_set_aside_description='' or
	charindex('('+fk.type_set_aside_description+')',pk.typeofsetasideText )>0,
	NULL,fk.type_set_aside_description)) as MaxOfNewFKtype_set_aside_description,
count(distinct iif(fk.type_set_aside_description=pk.typeofsetasideText or
	fk.type_set_aside_description='' or
	charindex('('+fk.type_set_aside_description+')',pk.typeofsetasideText )>0,
	NULL,fk.type_set_aside_description)) as unmatched_name_count,
pk.typeofsetasideText as PKtypeofsetasideText,
max(iif(fk.type_set_aside_description=pk.typeofsetasideText or
	fk.type_set_aside_description='' or
	charindex('('+fk.type_set_aside_description+')',pk.typeofsetasideText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.typeofsetaside' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.typeofsetaside as pk
On pk.typeofsetaside=fk.[type_set_aside]
GROUP BY fk.[type_set_aside], pk.typeofsetasideText
HAVING max(iif(fk.type_set_aside_description=pk.typeofsetasideText or
	fk.type_set_aside_description='' or
	charindex('('+fk.type_set_aside_description+')',pk.typeofsetasideText )>0,
	0,1))=1
ORDER BY fk.[type_set_aside]


--List new [ultimate_parent_legal_enti] for insertion into Vendor.VendorName
SELECT fk.[ultimate_parent_legal_enti],
'Vendor.VendorName' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Vendor.VendorName as pk
On pk.vendorname=fk.[ultimate_parent_legal_enti]
WHERE pk.vendorname is NULL
GROUP BY fk.[ultimate_parent_legal_enti]
ORDER BY fk.[ultimate_parent_legal_enti]


--List new [ultimate_parent_unique_ide] for insertion into Contractor.Dunsnumber
SELECT fk.[ultimate_parent_unique_ide],
'Contractor.Dunsnumber' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Contractor.Dunsnumber as pk
On pk.DUNSnumber=fk.[ultimate_parent_unique_ide]
WHERE pk.DUNSnumber is NULL
GROUP BY fk.[ultimate_parent_unique_ide]
ORDER BY fk.[ultimate_parent_unique_ide]


--List new [undefinitized_action] and updated undefinitized_action_desc for insertion into FPDSTypeTable.lettercontract
SELECT fk.[undefinitized_action],
max(iif(fk.undefinitized_action_desc=pk.UndefinitizedActionText or
	fk.undefinitized_action_desc='' or
	charindex('('+fk.undefinitized_action_desc+')',pk.UndefinitizedActionText )>0,
	NULL,fk.undefinitized_action_desc)) as MaxOfNewFKundefinitized_action_desc,
count(distinct iif(fk.undefinitized_action_desc=pk.UndefinitizedActionText or
	fk.undefinitized_action_desc='' or
	charindex('('+fk.undefinitized_action_desc+')',pk.UndefinitizedActionText )>0,
	NULL,fk.undefinitized_action_desc)) as unmatched_name_count,
pk.UndefinitizedActionText as PKUndefinitizedActionText,
max(iif(fk.undefinitized_action_desc=pk.UndefinitizedActionText or
	fk.undefinitized_action_desc='' or
	charindex('('+fk.undefinitized_action_desc+')',pk.UndefinitizedActionText )>0,
	1,0)) as any_name_match,
'FPDSTypeTable.lettercontract' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN FPDSTypeTable.lettercontract as pk
On pk.LetterContract=fk.[undefinitized_action]
GROUP BY fk.[undefinitized_action], pk.UndefinitizedActionText
HAVING max(iif(fk.undefinitized_action_desc=pk.UndefinitizedActionText or
	fk.undefinitized_action_desc='' or
	charindex('('+fk.undefinitized_action_desc+')',pk.UndefinitizedActionText )>0,
	0,1))=1
ORDER BY fk.[undefinitized_action]


--List new [vendor_legal_org_name] for insertion into Vendor.VendorName
SELECT fk.[vendor_legal_org_name],
'Vendor.VendorName' as PrimaryKeyTable
FROM ErrorLogging.source_procurement_transaction as fk
LEFT OUTER JOIN Vendor.VendorName as pk
On pk.vendorname=fk.[vendor_legal_org_name]
WHERE pk.vendorname is NULL
GROUP BY fk.[vendor_legal_org_name]
ORDER BY fk.[vendor_legal_org_name]


